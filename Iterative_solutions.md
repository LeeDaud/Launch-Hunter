Virtuals 打新监控系统
V1 稳定可用版优化方案
一、版本定位

本版本目标不是功能扩展，而是构建“高可信度实时监控系统”。

核心原则：

系统在高波动环境下必须稳定
数据不能乱跳
断线不能丢失
指标必须一致
UI 不能误导

这是一个“可以放心依赖”的版本，而不是“功能很多”的版本。

——

二、当前能力回顾

系统已经具备：

可输入 Token CA 追踪
持仓地址统计
累计买卖统计
成本与 BE MCAP 计算
1m / 5m 税后交易量
Protocol Monitor 模块
SSE 实时推送
Base 链监听

系统已经具备功能雏形，但存在潜在风险：

SSE 断线不可控
可能乱序或重复
Transfer 未分类
前端高频重渲染
无连接状态反馈
用户无法判断数据是否完整

——

三、V1 版本核心优化目标
目标一：实时流稳定性

让系统在断线、波动、长时间运行情况下保持一致性。

优化项：

引入 cursor 回放机制
每条推送携带：

blockNumber

logIndex

tokenCA

seq

前端记录最后 cursor
重连时自动补发缺失区间

去重机制
前端基于 txHash + logIndex 去重
防止重复渲染

乱序校正
使用 blockNumber 排序
仅更新比当前 cursor 更新的数据

SSE 心跳机制
每 15 秒 ping
前端展示连接状态：

Connected

Reconnecting

Disconnected

用户价值：

用户可以确认数据实时性
断网恢复后数据连续
不会因为刷新导致历史丢失

——

目标二：数据一致性与语义准确

当前 Transfer 数据混合了真实买卖与内部转账。

优化项：

基础交易分类

区分：

EOA ↔ EOA
EOA ↔ Router
Router ↔ Pair
Pair ↔ EOA
Protocol ↔ 任意

只将真实买卖计入交易量与净流入。

Bucket 与逐笔分层

高频阶段仅推 minute bucket
展开详情再拉逐笔

减少 UI 抖动
降低渲染压力

稳定 BE MCAP 计算

确保：

成本统计只来自真实买入
卖出扣减逻辑一致
税率逻辑与协议一致

用户价值：

交易量真实
净流入可信
成本计算稳定
指标可复盘

——

目标三：系统可观测性

用户必须知道系统是否健康。

新增模块：

System Health 面板（轻量版）

展示：

当前监听区块高度
最新处理区块
延迟毫秒数
每分钟事件数量
SSE 连接状态

产品价值：

用户知道“系统在工作”
异常可以快速定位

——

目标四：性能与运行稳定

目标：长时间运行不崩溃。

优化点：

内存治理
仅保留最近 N 分钟逐笔数据
更早数据只保留聚合

Token Watch 数量限制
默认单 Token
多 Token 需显式启用

推送节流
逐笔高频阶段仅推聚合

前端优化
表格虚拟滚动
memo 化组件
分模块局部更新

用户价值：

界面流畅
长时间运行稳定
VPS 不爆内存

——

四、V1 成功标准

连续运行 6 小时无异常
断网恢复后数据完整
无重复事件
无乱序闪跳
成本与 BE MCAP 稳定
页面不卡顿

——

五、用户体验层改进（轻量但重要）

连接状态小圆点
绿色：正常
黄色：重连中
红色：断开

“最后更新”时间
例如：Last update: 3s ago

关键指标冻结机制
当连接断开时显示数据已暂停

这些改动很小，但信任感极强。

——

六、本版本不做的事情

不做多 token watchlist
不做自动发现
不做复杂告警系统
不做历史回放
不做跨链

V1 专注稳定。

——

七、版本价值总结

这一版的价值不在于功能增加。

而在于：

系统从“能跑”
升级为“可信赖”。

在打新这种高波动、高风险环境里，
稳定性本身就是核心竞争力。